const { Pool } = require('pg'); const pool = new Pool({ connectionString: process.env.DATABASE_URL, ssl: { rejectUnauthorized: false } }); exports.handler = async (event, context) => { const headers = { 'Access-Control-Allow-Origin': '*', 'Access-Control-Allow-Headers': 'Content-Type', 'Access-Control-Allow-Methods': 'GET, POST, OPTIONS', 'Content-Type': 'application/json' }; if (event.httpMethod === 'OPTIONS') { return { statusCode: 200, headers, body: '' }; } if (event.httpMethod !== 'POST') { return { statusCode: 405, headers, body: JSON.stringify({ success: false, error: 'Method not allowed' }) }; } try { const { name, teacher, message, x, y, type, gradient } = JSON.parse(event.body); // Validate input if (!name || !teacher || !message) { return { statusCode: 400, headers, body: JSON.stringify({ success: false, error: 'Missing required fields' }) }; } const result = await pool.query( `INSERT INTO gratitude_leaves (name, teacher, message, x, y, type, gradient) VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING *`, [name, teacher, message, x, y, type, gradient] ); return { statusCode: 200, headers, body: JSON.stringify({ success: true, data: result.rows[0] }) }; } catch (error) { console.error('Database error:', error); return { statusCode: 500, headers, body: JSON.stringify({ success: false, error: error.message }) }; } };
